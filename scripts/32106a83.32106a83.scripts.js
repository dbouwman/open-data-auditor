"use strict";var auditorApp=angular.module("auditorApp",["ngResource","ngSanitize","ngCookies","ui.router"]);auditorApp.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/home"),a.state("home",{url:"/home",templateUrl:"templates/home.html",controller:"HomeController"}).state("results",{url:"/search?q",templateUrl:"templates/results.html",controller:"ResultsController"}).state("dataset",{url:"/dataset/:id",templateUrl:"templates/dataset.html",controller:"DatasetController"})}]),angular.module("auditorApp").controller("HomeController",["$scope",function(){}]),angular.module("auditorApp").controller("ResultsController",["$scope","$stateParams","$log","searchService",function(a,b,c,d){c.info(b.q);var e={q:"*"};b.q&&(e.q=b.q),a.query=e.q,a.openDataBaseUrl="http://openepa.dcdev.opendata.arcgis.com",d.getDatasets(e).then(function(b){a.results=b.data},function(b){a.error=b})}]),angular.module("auditorApp").controller("SearchController",["$scope","$location","$log",function(a,b){a.search=function(a){console.log("got search! q:"+a),b.path("/search").search({q:a})}}]),angular.module("auditorApp").controller("DatasetController",["$scope","$stateParams","$log","$filter","searchService","featureLayerService","itemService",function(a,b,c,d,e,f,g){c.info("Got dataset id: "+b.id);var h="http://openepa.dcdev.opendata.arcgis.com";e.getDataset(h,b.id).then(function(b){a.dataset=b.data,f.getFeatureLayerJson(b.data.url).then(function(b){a.layer=b,a.layer.fields=d("orderBy")(b.fields,"name",!1)},function(b){a.layerError=b}),g.getItemJson(b.data.item_id).then(function(b){a.item=b},function(b){a.itemError=b})},function(b){a.datasetError=b})}]),angular.module("auditorApp").factory("searchService",["$http","$q","$log",function(a,b,c){return{getDatasets:function(d){c.info("searchService.getDatasets params: "+JSON.stringify(d));var e=b.defer();return a({method:"GET",url:"http://openepa.dcdev.opendata.arcgis.com/datasets.json?q="+d.q}).success(function(a,b,d){c.info(a,b,d()),e.resolve(a)}).error(function(a,b,d){c.error(a,b,d()),e.reject(b)}),e.promise},getDataset:function(d,e){var f=b.defer();return a({method:"GET",url:d+"/datasets/"+e+".json"}).success(function(a,b,d){c.info(a,b,d()),f.resolve(a)}).error(function(a,b,d){c.error(a,b,d()),f.reject(b)}),f.promise}}}]),angular.module("auditorApp").factory("featureLayerService",["$http","$q","$log",function(a,b,c){return{getFeatureLayerJson:function(d){var e=b.defer();return a({method:"GET",url:d+"?f=json"}).success(function(a,b,d){c.info(a,b,d()),e.resolve(a)}).error(function(a,b,d){c.error(a,b,d()),e.reject(b)}),e.promise}}}]),angular.module("auditorApp").factory("itemService",["$http","$q","$log",function(a,b,c){return{getItemJson:function(d){var e=b.defer();return a({method:"GET",url:"http://www.arcgis.com/sharing/rest/content/items/"+d+"?f=json"}).success(function(a,b,d){c.info(a,b,d()),e.resolve(a)}).error(function(a,b,d){c.error(a,b,d()),e.reject(b)}),e.promise}}}]);